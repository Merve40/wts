# WTS Api Wiki

This Tutorial will portray the main concepts on how to apply the database api (api.ts).

The `api.ts` class communicates directly with the server via `Http`. Each table in the database has it's own class entity in our application, for example `AccountTable`, `AdressTable`, etc. Each of these classes need to inherit and implement the `Base` classes abstract methods.

## 1) Usage

Example: *Retrieve all accounts that have the email: test33@mail.com in `login.ts`*

All entities will be injected by ionic, so simply passing the entity into the constructor will do the job. Each table needs to have a reference to the calling class, in order to be able to reference methods inside the `LoginPage` with the `this` identifier.

```javascript
constructor(public accountTable:AccountTable){
    accountTable.setSrcClass(this);
}
```

In order to retrieve data, a callback method needs to be defined, which is why the class needs to implement the `OnResultComplete` interface. It defines a method `onComplete(source:string, json:any)`, which will be invoked inside the `api`, once the result has been fetched. This method will be used for all database requests within this class. The `source` will be defined by the programmer, in order to identify which result is being returned inside the `onComplete` method and the `json` is the result returned by the database. It cas either be a json object or a json array.
The following code shows how to log in a user, with `email` and `password`.

```javascript
login(){
    if (this.email && this.password) {
      this.accountTable.getByValue("Email",this.email, "1",this.onComplete);
    }
}

onComplete(source:string, json:any){
    if(source == "1"){
         if (json.body.Passwort == this.password) {
             this.navCtrl.push(ProfilePage, { userId: json.id });
         }
    }
}

```

## 2) Api Functionalities

### **Create** a new entry

**1st** argument = account object,  
**2nd** argument = flag,  
**3rd** argument = callback method

```javascript
acc = {
    Adresse_id: "A_1";
    Email: "my-email@mail.com";
    Passwort: "my-password";
    Usergruppe: "group_1";
}

AccountTable.push(acc, "my-flag", this.onComplete);
```

### **Delete** an entry

**1st** argument= id *(push id generated by firebase)*  
 **2nd** argument = flag,  
 **3rd** argument = callback method
```javascript
AccountTable.delete("KxAL2VbfVT-UIhzjulw", "my-flag", this.onComplete);
```

### **Update** an entry

**1st** argument= id *(push id generated by firebase)*  
 **2nd** argument = account object,  
 **3rd** argument =  flag,  
 **4th** argument = callback method
```javascript
acc = {
    Adresse_id: "A_2";
    Email: "my-email@mail.com";
    Passwort: "my-password";
    Usergruppe: "group_1";
}
AccountTable.update("KxAL2VbfVT-UIhzjulw", acc, "my-flag", this.onComplete);
```

### **Get** an entry with its id 

**1st** argument= id *(push id generated by firebase)*,  
 **2nd** argument = flag,  
 **3rd** argument = callback method

```javascript
AccountTable.getById("KxAL2VbfVT-UIhzjulw", "my-flag", this.onComplete);
```

### **Get One** by key and value

**1st** argument = key *(Email)*,  
**2nd** argument = value,  
**3rd** argument = flag,
**4th** argument = callback method


```javascript
AccountTable.getByValue("Email", "my-email@mail.com", "my-flag2", func: Function)
``` 

### **Get All** entries

**1st** argument= flag,    
**2nd** argument = callback method 

```javascript
AccountTable.getAll( "my-flag", this.onComplete);
```

### **Filter/Search** entries by _key_ and _value_

**1st** argument = key *(Usergruppe)*,  
**2nd** argument = value,  
**3rd** argument = flag,  
**4th** argument = callback method

```javascript
AccountTable.filterByValue("Usergruppe", "group_1", "my-flag", this.onComplete); 
```

### **Filter/Search and Limit** entries by _key_ and _value_

Retrieves a certain amound of entries.

**1st** argument = key *(Usergruppe)*,  
**2nd** argument = value,  
**3rd** argument = limit *(10)*,  
**4th** argument = callback method

```javascript
AccountTable.filterByValueAndLimit("Usergruppe", "group_1", 10, "my-flag", this.onComplete)  
```

### **Get Value Starting With Prefix**

Retrives all entries, where the value of a key starts with a prefix.

**Prefix** = "group"  
**Target Values in DB** = "group_1", "group_2", "group_3"  
**Target Field in DB** = "Usergruppe" 

**1st** argument = key *(Usergruppe)*,  
**2nd** argument = value,  
**3rd** argument = limit *(10)*,   
**4th** argument = callback method

```javascript
AccountTable.getAllStartingWith("Usergruppe", "group", "my-flag4", this.onComplete);
```

### **Get All Containing**

Retrives all entries, where the value of a key contains the search-string.

**Search-String** = "p_1"  
**Target Value in DB** = "group_1"  
**Target Field in DB** = "Usergruppe"  

**1st** argument = key *(Usergruppe)*,  
**2nd** argument = value,  
**3rd** argument = limit *(10)*,  
**4th** argument = callback method

```javascript
AccountTable.getAllContaining("Usergruppe", "p_1", "my-flag4", this.onComplete);
```